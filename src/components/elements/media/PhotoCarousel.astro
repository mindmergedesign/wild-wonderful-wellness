---
// Packages
import { Image } from 'astro:assets'
import { urlForImage } from '@/sanity/lib/urlForImage'
import { ChevronLeft } from 'lucide-astro'
import type { ImageGallery } from '@/sanity/schemaTypes/imageGallery'
import '@/styles/blaze.css'

interface Props {
	gallery: ImageGallery
	class?: string
}

const { class: className, gallery } = Astro.props as Props
---

<div class={`blaze-slider ${className}`} role="region" aria-label="Image carousel">
	<div class="blaze-container">
		<div class="blaze-track-container relative">
			<div class="blaze-track" role="list">
				{
					gallery?.images?.map(({ ...item }) => (
						<div class="relative aspect-3/2" role="listitem">
							<Image
								src={`${urlForImage(item).quality(60).url()}`}
								alt={item?.alt || 'Gallery image'}
								width={1000}
								height={800}
								class="h-full w-full object-cover"
								loading={'lazy'}
							/>
							{item?.alt && (
								<div class="absolute right-0 bottom-0 left-0 flex h-24 w-full items-end bg-linear-to-t from-black/25 via-black/12 to-transparent opacity-80">
									<p class="my-0! px-3 pb-3 text-sm! text-white md:px-6 md:pb-6">
										{item?.alt}
										{item?.credits && ` - ${item?.credits}`}
									</p>
								</div>
							)}
						</div>
					))
				}
			</div>
		</div>

		{
			gallery?.images && gallery.images.length > 1 && (
				<div class="absolute inset-0 flex h-full w-full flex-wrap items-center justify-between px-3">
					{/* navigation buttons */}
					<button class="blaze-prev text-primary!" type="button" aria-label="Previous image">
						<ChevronLeft class="h-20 w-20 text-white/60 hover:text-white" aria-hidden="true" />
					</button>
					<button class="blaze-next" type="button" aria-label="Next image">
						<ChevronLeft class="h-20 w-20 text-white/60 hover:text-white" aria-hidden="true" />
					</button>
				</div>
			)
		}
	</div>

	<div class="relative z-20 flex w-full flex-wrap">
		{/* pagination container */}
		<div
			class="blaze-pagination text-primary flex w-full justify-center"
			role="tablist"
			aria-label="Carousel pagination"
		>
		</div>
	</div>
</div>

<script>
	import BlazeSlider from 'blaze-slider'
	import 'blaze-slider/dist/blaze.css'

	document.addEventListener('astro:page-load', () => {
		const el = document.querySelector('.blaze-slider')
		//@ts-ignore
		new BlazeSlider(el)
	})
</script>
