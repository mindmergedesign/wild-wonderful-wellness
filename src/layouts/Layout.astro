---
// Packages
import '@/styles/global.css'
import { ClientRouter } from 'astro:transitions'

// Components
import Footer from '@/components/layout/Footer.astro'
import Header from '@/components/layout/Header.astro'
import PreviewBanner from '@/components/elements/interactive/PreviewBanner.astro'

// Misc
import { settings } from '@/sanity/lib/queries'
const { class: className, ...rest } = Astro.props

// Check if preview mode is enabled via cookie
const previewCookie = Astro.cookies.get('sanity-preview')
const isPreview = previewCookie?.value === 'true'

// Debug logging
if (import.meta.env.DEV) {
	console.log('Layout - Preview status:', {
		cookieValue: previewCookie?.value,
		isPreview
	})
}
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="generator" content={Astro.generator} />
		<meta name="viewport" content="width=device-width, initial-scale=1" />

		<link rel="sitemap" href="/sitemap-index.xml" />

		<ClientRouter />

		<!-- Prevent flash of unstyled content for dark mode -->
		<script is:inline>
			;(function () {
				const theme =
					localStorage.getItem('theme') ||
					(window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light')
				if (theme === 'dark') {
					document.documentElement.classList.add('dark')
				}
			})()
		</script>

		<slot name="head" />
	</head>

	<body>
		<a
			class="bg-secondary text-secondary-foreground absolute left-0 z-50 m-3 -translate-y-56 p-3 no-underline transition focus:translate-y-0"
			href="#main-content">Skip Navigation</a
		>

		{isPreview && <PreviewBanner />}

		<div
			class="flex min-h-screen flex-col justify-between transition-all duration-500 ease-out"
			class:list={[isPreview && 'pb-20']}
		>
			<Header />

			<div class="prose prose-lg max-w-none grow">
				<slot />
			</div>

			<Footer settings={settings}>
				<slot name="footer" />
			</Footer>
		</div>
	</body>
</html>
