---
import Layout from '@/layouts/Layout.astro'

// Check preview status
const previewCookie = Astro.cookies.get('sanity-preview')
const isPreview = previewCookie?.value === 'true'
---

<Layout>
	<main id="main-content" class="container mx-auto px-4 py-12">
		<div class="mx-auto max-w-2xl">
			<h1 class="mb-6 text-4xl font-bold">Preview Mode Test Page</h1>

			<div class="bg-card mb-6 rounded-lg border p-6">
				<h2 class="mb-4 text-2xl font-semibold">Current Status</h2>
				<div class="space-y-2">
					<p class="flex items-center gap-2">
						<strong>Preview Mode:</strong>
						{
							isPreview ? (
								<span class="bg-success text-success-foreground rounded px-3 py-1">âœ“ Active</span>
							) : (
								<span class="bg-error text-error-foreground rounded px-3 py-1">âœ— Inactive</span>
							)
						}
					</p>
					<p><strong>Cookie Value:</strong> {previewCookie?.value || 'Not set'}</p>
				</div>
			</div>

			<div class="bg-card mb-6 rounded-lg border p-6">
				<h2 class="mb-4 text-2xl font-semibold">Cookie Details</h2>
				<div class="space-y-2">
					<p><strong>sanity-preview cookie:</strong></p>
					<pre
						class="bg-muted overflow-auto rounded p-4 text-sm">{JSON.stringify({ 
						name: 'sanity-preview',
						value: previewCookie?.value || 'not set',
						exists: !!previewCookie
					}, null, 2)}</pre>
				</div>
			</div>

			<div class="bg-card mb-6 rounded-lg border p-6">
				<h2 class="mb-4 text-2xl font-semibold">Environment Variables</h2>
				<div class="space-y-2">
					<p>
						<strong>SANITY_API_READ_TOKEN:</strong>
						{import.meta.env.SANITY_API_READ_TOKEN ? 'âœ“ Set' : 'âœ— Not set'}
					</p>
					<p>
						<strong>SANITY_PREVIEW_SECRET:</strong>
						{import.meta.env.SANITY_PREVIEW_SECRET ? 'âœ“ Set' : 'âœ— Not set (using default)'}
					</p>
					<p>
						<strong>PUBLIC_SANITY_VISUAL_EDITING_ENABLED:</strong>
						{import.meta.env.PUBLIC_SANITY_VISUAL_EDITING_ENABLED || 'false'}
					</p>
				</div>
			</div>

			<div class="bg-card rounded-lg border p-6">
				<h2 class="mb-4 text-2xl font-semibold">Test Links</h2>
				<div class="space-y-3">
					<div>
						<p class="mb-2 font-semibold">Enable Preview (default secret):</p>
						<a
							href="/api/preview?secret=preview-secret-token"
							class="text-primary underline hover:no-underline"
						>
							/api/preview?secret=preview-secret-token
						</a>
					</div>

					<div>
						<p class="mb-2 font-semibold">Enable Preview (custom secret from .env):</p>
						<a
							href={`/api/preview?secret=${import.meta.env.SANITY_PREVIEW_SECRET || 'YOUR_SECRET'}`}
							class="text-primary underline hover:no-underline"
						>
							/api/preview?secret={import.meta.env.SANITY_PREVIEW_SECRET || 'YOUR_SECRET'}
						</a>
					</div>

					<div>
						<p class="mb-2 font-semibold">Exit Preview:</p>
						<a href="/api/exit-preview" class="text-primary underline hover:no-underline">
							/api/exit-preview
						</a>
					</div>
				</div>
			</div>

			<div class="bg-info text-info-foreground mt-6 rounded-lg p-4">
				<p class="mb-2 font-semibold">ðŸ’¡ Troubleshooting Tips:</p>
				<ul class="list-inside list-disc space-y-1 text-sm">
					<li>Check the browser console for debug logs</li>
					<li>Make sure you have a .env file with SANITY_API_READ_TOKEN</li>
					<li>Restart the dev server after creating .env</li>
					<li>Check that cookies are enabled in your browser</li>
					<li>Try in an incognito window to rule out cookie issues</li>
				</ul>
			</div>
		</div>
	</main>
</Layout>
